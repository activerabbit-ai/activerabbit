<% content_for :page_title do %>
  New Project
<% end %>

<% content_for :head do %>
  <style>
    .tech-stack-option {
      position: relative;
      overflow: hidden;
    }

    .tech-stack-option:hover {
      transform: translateY(-2px);
      border-color: #d1d5db;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .tech-stack-option.selected .tech-stack-indicator {
      opacity: 1;
    }

        .tech-stack-option.selected .tech-stack-overlay {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    }

    .tech-stack-option.selected {
      box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4), 0 4px 6px -2px rgba(99, 102, 241, 0.2);
      border: 2px solid #6366f1;
      background-color: #fefefe;
    }

    .tech-stack-option.selected span:last-child {
      color: #4338ca !important;
      font-weight: 700;
    }

    .tech-stack-option.selected span:first-child {
      animation: bounce 0.6s ease-in-out;
    }

    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0,0,0);
      }
      40%, 43% {
        transform: translate3d(0,-8px,0);
      }
      70% {
        transform: translate3d(0,-4px,0);
      }
      90% {
        transform: translate3d(0,-2px,0);
      }
    }
  </style>
<% end %>

<!-- Page Header -->
<div class="mb-8">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">Create New Project</h1>
    <p class="text-gray-600 mt-1">Set up monitoring for a new application</p>
  </div>
</div>

<!-- Main Content -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Form Section -->
  <div class="lg:col-span-2">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-6">Project Details</h2>

      <%= form_with model: @project, local: true, class: "space-y-6" do |form| %>

      <!-- Error Messages -->
      <% if @project.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.268 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-red-800">
                There were <%= pluralize(@project.errors.count, "error") %> with your submission:
              </h3>
              <div class="mt-2 text-sm text-red-700">
                <ul class="list-disc pl-5 space-y-1">
                  <% @project.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
        </div>
      <% end %>

              <!-- Project Name -->
        <div>
          <%= form.label :name, "Project Name", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :name,
              placeholder: "My Rails App",
              class: "appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
          <% if @project.errors[:name].any? %>
            <p class="mt-1 text-sm text-red-600"><%= @project.errors[:name].first %></p>
          <% end %>
        </div>

        <!-- Project URL -->
        <div>
          <%= form.label :url, "Application URL", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.url_field :url,
              placeholder: "https://myapp.com",
              class: "appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
          <p class="mt-1 text-xs text-gray-500">The URL where your Rails application is hosted</p>
          <% if @project.errors[:url].any? %>
            <p class="mt-1 text-sm text-red-600"><%= @project.errors[:url].first %></p>
          <% end %>
        </div>

              <!-- Project Description (Optional) -->
        <div>
          <%= form.label :description, "Description (Optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_area :description,
              rows: 3,
              placeholder: "Brief description of your project...",
              class: "appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" %>
        </div>

        <!-- Tech Stack Selection -->
        <div>
          <%= form.label :tech_stack, "Tech Stack", class: "block text-sm font-medium text-gray-700 mb-3" %>
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6" data-controller="tech-stack">
            <% tech_stacks = [
              { name: 'Ruby on Rails', icon: 'üíé', value: 'rails' },
              { name: 'Node.js', icon: 'üü¢', value: 'nodejs' },
              { name: 'React', icon: '‚öõÔ∏è', value: 'react' },
              { name: 'Vue.js', icon: 'üíö', value: 'vue' },
              { name: 'Django', icon: 'üêç', value: 'django' },
              { name: 'Laravel', icon: 'üî∂', value: 'laravel' },
              { name: 'Express.js', icon: 'üöÄ', value: 'express' },
              { name: 'Next.js', icon: '‚ñ≤', value: 'nextjs' },
              { name: 'Nuxt.js', icon: 'üíô', value: 'nuxt' },
              { name: 'Flask', icon: 'üå∂Ô∏è', value: 'flask' },
              { name: 'Spring Boot', icon: 'üçÉ', value: 'spring' },
              { name: 'Other', icon: '‚öôÔ∏è', value: 'other' }
            ] %>

                        <% tech_stacks.each do |stack| %>
              <% is_rails = stack[:value] == 'rails' %>
              <% if is_rails %>
                <label class="tech-stack-option relative flex cursor-pointer rounded-xl bg-white p-6 shadow-md border border-gray-100 focus:outline-none hover:shadow-lg hover:scale-105 transition-all duration-200">
                  <%= form.radio_button :tech_stack, stack[:value],
                      class: "sr-only",
                      required: true,
                      data: { action: "change->tech-stack#select" } %>
                  <div class="flex flex-col items-center text-center w-full relative z-10">
                    <span class="text-3xl mb-3 filter drop-shadow-sm"><%= stack[:icon] %></span>
                    <span class="text-sm font-semibold text-gray-700 leading-tight"><%= stack[:name] %></span>
                  </div>
                  <div class="tech-stack-indicator absolute -inset-px rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 opacity-0 pointer-events-none transition-opacity duration-200"></div>
                  <div class="tech-stack-overlay absolute inset-0 rounded-xl pointer-events-none"></div>
                </label>
              <% else %>
                <div class="tech-stack-option relative flex rounded-xl bg-gray-100 p-6 shadow-md border border-gray-200 opacity-50 cursor-not-allowed">
                  <div class="flex flex-col items-center text-center w-full relative z-10">
                    <span class="text-3xl mb-3 filter grayscale"><%= stack[:icon] %></span>
                    <span class="text-sm font-semibold text-gray-400 leading-tight"><%= stack[:name] %></span>
                    <span class="text-xs text-gray-400 mt-1">Coming Soon</span>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <p class="mt-2 text-xs text-gray-500">Select the primary technology stack for this project</p>
        </div>

              <!-- Environment -->
        <div>
          <%= form.label :environment, "Environment", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.select :environment,
              options_for_select([
                ['Production', 'production'],
                ['Staging', 'staging'],
                ['Development', 'development'],
                ['Testing', 'testing']
              ], 'production'),
              {},
              { class: "appearance-none relative block w-full px-3 py-2 border border-gray-300 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" } %>
          <p class="mt-1 text-xs text-gray-500">Select the primary environment for this project</p>
        </div>

        <!-- Actions -->
        <div class="flex items-center justify-between pt-6 border-t border-gray-200">
          <%= link_to dashboard_path,
              class: "text-sm text-gray-500 hover:text-gray-700" do %>
            ‚Üê Back to dashboard
          <% end %>

          <%= form.submit "Create Project & Get Started",
              class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Info Section -->
  <div class="lg:col-span-1">
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">What happens next?</h3>
          <div class="mt-2 text-sm text-blue-700">
            <p>After creating your project, you'll be guided through installing the ActiveRabbit gem in your Rails application. This will enable automatic error tracking and performance monitoring.</p>
          </div>
        </div>
      </div>
    </div>
    <!-- AI Autofix with GitHub -->
    <div class="bg-gray-100 rounded-xl p-6 mt-6 shadow-lg border border-gray-400">
      <div class="flex items-center mb-4">
        <div class="flex-shrink-0 w-10 h-10 bg-gray-900 rounded-lg flex items-center justify-center">
          <svg viewBox="0 0 16 16" width="22" height="22" class="text-white" aria-hidden="true">
            <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8a8 8 0 005.47 7.59c.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.5 7.5 0 012 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-base font-semibold text-gray-900">ü§ñ AI Autofix with GitHub</h3>
          <p class="text-xs text-gray-600">Automatic PR creation with AI-generated fixes for your errors</p>
        </div>
      </div>

      <div class="space-y-3 mb-5">
        <div class="flex items-start">
          <span class="flex-shrink-0 w-5 h-5 bg-green-500/20 rounded-full flex items-center justify-center mr-3 mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
            </svg>
          </span>
          <p class="text-sm text-gray-600">AI analyzes the error and generates a patch for correction</p>
        </div>
        <div class="flex items-start">
          <span class="flex-shrink-0 w-5 h-5 bg-green-500/20 rounded-full flex items-center justify-center mr-3 mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
            </svg>
          </span>
          <p class="text-sm text-gray-600">Automatically creates a Pull Request in your repository</p>
        </div>
        <div class="flex items-start">
          <span class="flex-shrink-0 w-5 h-5 bg-green-500/20 rounded-full flex items-center justify-center mr-3 mt-0.5">
            <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
            </svg>
          </span>
          <p class="text-sm text-gray-600">You review and merge ‚Äî all under your control</p>
        </div>
      </div>

      <!-- Visual flow -->
      <div class="bg-white/5 rounded-lg p-4 mb-4">
        <div class="flex items-center justify-between text-xs">
          <div class="flex flex-col items-center">
            <span class="w-8 h-8 bg-red-500/20 rounded-full flex items-center justify-center mb-1">
              <span class="text-red-400">üêõ</span>
            </span>
            <span class="text-gray-400">Error</span>
          </div>
          <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
          <div class="flex flex-col items-center">
            <span class="w-8 h-8 bg-purple-500/20 rounded-full flex items-center justify-center mb-1">
              <span class="text-purple-400">ü§ñ</span>
            </span>
            <span class="text-gray-400">AI Analysis</span>
          </div>
          <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
          <div class="flex flex-col items-center">
            <span class="w-8 h-8 bg-blue-500/20 rounded-full flex items-center justify-center mb-1">
              <span class="text-blue-400">üìù</span>
            </span>
            <span class="text-gray-400">PR</span>
          </div>
          <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
          <div class="flex flex-col items-center">
            <span class="w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center mb-1">
              <span class="text-green-400">‚úÖ</span>
            </span>
            <span class="text-gray-400">Fixed!</span>
          </div>
        </div>
      </div>

      <div class="flex items-center text-xs text-gray-600 bg-white/5 rounded-lg px-3 py-2">
        <svg class="w-4 h-4 mr-2 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>After creating your project, you'll be guided through connecting your GitHub repository. This will enable automatic PR creation with AI-generated fixes for your errors.</span>
      </div>
    </div>
  </div>
</div>
