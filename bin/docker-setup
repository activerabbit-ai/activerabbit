#!/bin/bash
set -e

echo "🐳 Setting up ActiveAgent with Docker..."

# Build the containers
echo "📦 Building Docker containers..."
docker-compose build

# Start the services
echo "🚀 Starting services..."
docker-compose up -d db redis

# Wait for database to be ready
echo "⏳ Waiting for database to be ready..."
docker-compose exec db bash -c 'until pg_isready -U postgres; do sleep 1; done'

# Setup the database
echo "🗃️  Setting up database..."
docker-compose run --rm web bundle exec rails db:create db:migrate

# Precompile assets
echo "🎨 Building Tailwind CSS..."
docker-compose run --rm web bundle exec rails tailwindcss:build

echo "✅ Setup complete! Run 'docker-compose up' to start the application."
echo "🌐 The application will be available at http://localhost:3000"