#!/bin/bash
set -e

echo "ğŸ³ Setting up ActiveAgent with Docker..."

# Build the containers
echo "ğŸ“¦ Building Docker containers..."
docker-compose build

# Start the services
echo "ğŸš€ Starting services..."
docker-compose up -d db redis

# Wait for database to be ready
echo "â³ Waiting for database to be ready..."
docker-compose exec db bash -c 'until pg_isready -U postgres; do sleep 1; done'

# Setup the database
echo "ğŸ—ƒï¸  Setting up database..."
docker-compose run --rm web bundle exec rails db:create db:migrate

# Precompile assets
echo "ğŸ¨ Building Tailwind CSS..."
docker-compose run --rm web bundle exec rails tailwindcss:build

echo "âœ… Setup complete! Run 'docker-compose up' to start the application."
echo "ğŸŒ The application will be available at http://localhost:3000"